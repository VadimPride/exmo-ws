window.$$exmoWS$$={},$$exmoWS$$.index=function(t,n,e){$$exmoWS$$.Helpers.EventEmitter.call(this);var r=this,o=!1,i=!1,s="object"==typeof e?e:{},c=new $$exmoWS$$.PublicWS(this),u=new $$exmoWS$$.PrivateWS(this);this.getPublicObject=function(){return c},this.getPrivateObject=function(){return u},this.getApiKey=function(){return o},this.getSecretKey=function(){return i},this.setApiKey=function(e){return!("string"!=typeof e||!e.length)&&(o=e,this.emit("setApiKey",e),!0)},this.setSecretKey=function(e){return!("string"!=typeof e||!e.length)&&(i=e,this.emit("setSecretKey",e),!0)},this.getSettingList=function(){return s||{}},this.getSetting=function(e,t){return this.getSettingList()[e]||t},this.spotTrades=function(e){return c.spotTrades(e)},this.spotTicker=function(e){return c.spotTicker(e)},this.spotOrderBookSnapshots=function(e){return c.spotOrderBookSnapshots(e)},this.spotOrderBookUpdates=function(e){return c.spotOrderBookUpdates(e)},this.spotUserTrades=function(){return u.spotUserTrades()},this.spotWallet=function(){return u.spotWallet()},this.spotOrders=function(){return u.spotOrders()},function(){if("function"!=typeof $$exmoWS$$.WebSocket)throw new Error("Websocket not support");if("object"!=typeof $$exmoWS$$.CryptoJS)throw new Error('Module "crypto-js" not found.');r.setApiKey(t),r.setSecretKey(n);function e(){u.closeConnection()}r.on("setApiKey",function(){e()}),r.on("setSecretKey",function(){e()})}()},window.$$exmoWS$$=$$exmoWS$$.index,window.$$exmoWS$$.process=void 0,window.$$exmoWS$$.global=void 0,window.$$exmoWS$$.window=window,window.$$exmoWS$$.WebSocket=WebSocket,window.$$exmoWS$$.CryptoJS=CryptoJS,$$exmoWS$$.Helpers=new function(){this.getWindow=function(){return $$exmoWS$$.window||!1},this.getProcess=function(){return $$exmoWS$$.process||!1},this.getGlobal=function(){return $$exmoWS$$.global||!1},this.getRandInt=function(e,t){return Math.floor(e+Math.random()*(t+1-e))},this.EventEmitter=function(){var c=this,u={},r=0,o=10,f="_once";this.on=function(e,t,n){if("string"!=typeof e||"function"!=typeof t)return c;++r;n=String(String(r)+(!0===n?f:""));return"object"!=typeof u[e]&&(u[e]={}),u[e][n]=t,0<o&&c.listenerCount(e)>o&&console.warn("EventEmitter ",e,", exceeded maxListeners : ",o+"/"+c.listenerCount(e),". Use EE.setMaxListeners(n)!"),c},this.once=function(e,t){return c.on(e,t,!0)},this.getListerensName=function(){return Object.keys(u)},this.clearAllListerens=function(){var e,t=c.getListerensName();for(e in t)c.offAll(t[e]);return u},this.listenerCount=function(e){return"string"!=typeof e||"object"!=typeof u[e]?0:Object.keys(u[e]).length},this.setMaxListeners=function(e){return"number"==typeof e&&(o=parseInt(e),!0)},this.off=function(e,t){if("string"!=typeof e||"function"!=typeof t||"object"!=typeof u[e])return c;for(var n in u[e])u[e][n]===t&&delete u[e][n];return 0===Object.keys(u[e]).length&&delete u[e],c},this.offAll=function(e){if("object"!=typeof u[e])return c;for(var t in u[e])delete u[e][t];return delete u[e],c},this.emit=function(e,t,n,r,o,i){if("string"!=typeof e||"object"!=typeof u[e])return c;for(var s in u[e])"function"==typeof u[e][s]&&(u[e][s].call(this,t,n,r,o,i),0<=s.indexOf(f)&&c.off(e,u[e][s]));return c}},this.getUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e,t){return("x"==e?t=16*Math.random()|0:3&t|8).toString(16)})},this.checkUID=function(e){return!!new RegExp("^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$").test(String(e))}},$$exmoWS$$.SubscribeObject=function(e){$$exmoWS$$.Helpers.EventEmitter.call(this);var t=e,n={},r=$$exmoWS$$.SubscribeObject.STATUS_SUBSCRIBE;Date.now();this.getStatus=function(){return r},this.isSubscribe=function(){return this.getStatus()===$$exmoWS$$.SubscribeObject.STATUS_SUBSCRIBE},this.isUnsubscribe=function(){return this.getStatus()===$$exmoWS$$.SubscribeObject.STATUS_UNSUBSCRIBE},this.getTopic=function(){return t},this.getData=function(){return"object"==typeof n?n:{}},this.unsubscribe=function(){return!this.isUnsubscribe()&&(this.emit("unsubscribe",this),this.clearAllListerens(),!0)},this.update=function(e){if("object"!=typeof e)return!1;n=e,Date.now(),this.emit("update",this)}},$$exmoWS$$.SubscribeObject.STATUS_UNSUBSCRIBE=0,$$exmoWS$$.SubscribeObject.STATUS_SUBSCRIBE=1,$$exmoWS$$.WSObject=function(e){$$exmoWS$$.Helpers.EventEmitter.call(this);function c(e){var t=u.getSubscribeObject(e);return t||(t=new $$exmoWS$$.SubscribeObject(e),(n[t.getTopic()]=t).once("unsubscribe",function(){delete n[t.getTopic()],u.emit("unsubscribe",t),u.unsubscribe(t.getTopic()).catch(function(){})}),t.on("update",function(){u.emit("subscribe|update",t)}),u.emit("subscribe",t),t)}var u=this,f=!1,a=0,n={};this.getWS=function(){return new Promise(function(t,n){if(f)return t(f);if(null===f){var r=function(e){n(new Error(e.reason||"close")),u.once("ws|open",i),u.once("ws|error",o)},o=function(e){n(new Error(e.error||"error")),u.once("ws|open",i),u.off("ws|close",r)},i=function(e){t(e),u.off("ws|error",o),u.off("ws|close",r)};return u.once("ws|open",i),u.once("ws|error",o),void u.once("ws|close",r)}f=null;var s=new $$exmoWS$$.WebSocket(e);s.closeConnection=function(e){if(s.isConnection())try{return s.close(1e3,String(e||"close")),!0}catch(e){console.error(e)}return!1},s.isConnection=function(){return 1===s.readyState},s.sendMessage=function(e){try{if(s.isConnection())return s.send(String(e)),!0}catch(e){}return!1};s.sendObject=function(e){try{if(s.isConnection())return s.send(JSON.stringify(e)),!0}catch(e){}return!1};s.onopen=function(){t(f=s),u.emit("ws|open",s)},s.onerror=function(e){f=!1,n(new Error(e.error||"error")),u.emit("ws|error",e)},s.onclose=function(e){f=!1,n(new Error(e.reason||"close")),u.emit("ws|close",e)},s.onmessage=function(e){var t=String(e.data||"");u.emit("ws|message",t);try{var n=JSON.parse(t);n.id&&u.emit("ws|data|"+n.id,n);var r=!1;"info"===n.event&&"string"==typeof n.message&&u.emit("info",n.message),"subscribed"===n.event&&"string"==typeof n.topic&&c(n.topic),"update"===n.event&&"string"==typeof n.topic&&"object"==typeof n.data&&(r=u.getSubscribeObject(n.topic))&&r.update(n.data),"unsubscribe"===n.event&&"string"==typeof n.topic&&(r=u.getSubscribeObject(n.topic))&&r.unsubscribe(),u.emit("ws|data",n)}catch(e){console.error(e)}}})},this.isConnection=function(){return f&&f.isConnection()},this.closeConnection=function(){return!(!f||!f.isConnection())&&f.closeConnection()},this.preSend=function(e){return new Promise(function(e){e()})},this.send=function(s,e,c){return new Promise(function(t,n){e=parseInt(e||"2000");var r=!1;if("number"!=typeof e)return n(new Error("Invalid TTL value"));function o(e){try{r=!0,i&&(clearTimeout(i),i=!1)}catch(e){}return"error"===e.event||e.error?n(new Error(e.error||e.message||"Unknown error")):t(e)}var i=!1,i=setTimeout(function(e){e({error:"ttl"})},e,o);u.getWS().then(function(t){(c?function(){return new Promise(function(e){e()})}:u.preSend)(s).then(function(){if(r)return n(new Error("Res#21992"));s.id=++a;var e="ws|data|"+s.id;u.once(e,o),t.sendObject(s)||u.removeListener(e,o)}).catch(function(e){n(e)})}).catch(function(e){n(new Error("ConnectionError->"+e.message))})})},this.getSubscribeObjectList=function(){return n},this.getSubscribeObject=function(e){return this.getSubscribeObjectList()[e]||!1},this.subscribe=function(o){return new Promise(function(t,n){if("string"!=typeof o||!o.length)return n(new Error("InvalidTopic"));var r=u.getSubscribeObject(o);if(r)return t(r);u.send({method:"subscribe",topics:[o]}).then(function(e){return"subscribed"!==e.event?(console.error("UnknownErrorSubscribe",e),n(new Error("UnknownErrorSubscribe"))):(r=c(o),t(r))}).catch(function(e){n(e)})})},this.unsubscribe=function(e){return new Promise(function(t,n){if("string"!=typeof e||!e.length)return n(new Error("InvalidTopic"));var r=u.getSubscribeObject(e);if(!r)return n(new Error("SubscribeNotFound"));u.send({method:"unsubscribe",topics:[e]}).then(function(e){return"unsubscribed"!==e.event?(console.error("UnknownErrorUnsubscribe",e),n(new Error("UnknownErrorUnsubscribe"))):t(r)}).catch(function(e){n(e)})})},u.on("ws|open",function(){u.emit("connect",u)}),u.on("ws|close",function(){u.emit("disconnect",u);var e,t=u.getSubscribeObjectList();for(e in t)try{t[e].unsubscribe()}catch(e){}}),u.on("ws|message",function(e){u.emit("message",e)}),u.on("ws|data",function(e){u.emit("data",e)})},$$exmoWS$$.PublicWS=function(e){$$exmoWS$$.WSObject.call(this,"wss://ws-api.exmo.com:443/v1/public"),this.spotTrades=function(e){return this.subscribe("spot/trades:"+String(e||""))},this.spotTicker=function(e){return this.subscribe("spot/ticker:"+String(e||""))},this.spotOrderBookSnapshots=function(e){return this.subscribe("spot/order_book_snapshots::"+String(e||""))},this.spotOrderBookUpdates=function(e){return this.subscribe("spot/order_book_updates::"+String(e||""))}},$$exmoWS$$.PrivateWS=function(i){$$exmoWS$$.WSObject.call(this,"wss://ws-api.exmo.com:443/v1/private");var s=this,c=!1;this.preSend=function(){return new Promise(function(t,n){if(c)return t();var e=i.getApiKey(),r=i.getSecretKey();if("string"!=typeof e||!e.length)return n(new Error("InvalidApiKey"));if("string"!=typeof r||!r.length)return n(new Error("InvalidSecretKey"));var o=Date.now();s.send({method:"login",api_key:e,sign:$$exmoWS$$.CryptoJS.HmacSHA512(e+o,r).toString($$exmoWS$$.CryptoJS.enc.Base64),nonce:o},700,!0).then(function(e){return"logged_in"!==e.event?n(new Error("InvalidAuth")):(c=!0,void t())}).catch(function(e){return n(new Error("InvalidAuth->"+e.message))})})},this.spotUserTrades=function(){return this.subscribe("spot/user_trades")},this.spotWallet=function(){return this.subscribe("spot/wallet")},this.spotOrders=function(){return this.subscribe("spot/orders")},s.on("ws|close",function(){c=!1})};